const express = require("express");
const axios = require('axios');
const path = require("path");
const fs = require("fs");
const jsdom = require("jsdom");
const PORT = process.env.PORT || 5003;

const app = express();
const headers = {
    Accept: 'application/json',
    'Content-Type': 'application/json',
};

// CloudFront base URL
const CLOUDFRONT_URL = 'https://dfu1q19hvvqvl.cloudfront.net';

// Helper function to replace image URLs
function replaceImageUrl(imageUrl) {
    if (!imageUrl) return `${CLOUDFRONT_URL}/almutawassit.png`;
    
    // If it's already a full URL starting with the storage path, replace the base
    if (imageUrl.includes('admin.almutawassit.it/storage/')) {
        return imageUrl.replace('https://admin.almutawassit.it/storage/', `${CLOUDFRONT_URL}/`);
    }
    
    // If it's a relative path, add CloudFront base
    if (imageUrl.startsWith('/') || !imageUrl.includes('http')) {
        return `${CLOUDFRONT_URL}${imageUrl.startsWith('/') ? '' : '/'}${imageUrl}`;
    }
    
    // If it's almutawassit.it domain, replace with CloudFront
    if (imageUrl.includes('almutawassit.it/')) {
        return imageUrl.replace(/https?:\/\/(www\.)?almutawassit\.it\//, `${CLOUDFRONT_URL}/`);
    }
    
    return imageUrl;
}

// Helper function to serve HTML with meta tags
function serveHTMLWithMeta(res, title, description, keywords, url, image, filePath) {
    fs.readFile(filePath, "utf8", (err, data) => {
        if (err) {
            console.log(err);
            return res.redirect('/');
        }

        data = data
            .replace(/__TITLE__/g, title)
            .replace(/__DESCRIPTION__/g, description)
            .replace(/__KEYWORDS__/g, keywords)
            .replace(/__URL__/g, url)
            .replace(/__IMAGE__/g, replaceImageUrl(image));

        res.send(data);
    });
}

app.get("/", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/",
        "almutawassit.png",
        filePath
    );
});

app.get("/home", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "رئيسية المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/",
        "almutawassit.png",
        filePath
    );
});

app.get("/magazine", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "رئيسية المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/",
        "almutawassit.png",
        filePath
    );
});

app.get("/about", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "عن المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/about",
        "almutawassit.png",
        filePath
    );
});

app.get("/books", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "كتب المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/books",
        "almutawassit.png",
        filePath
    );
});

app.get("/featured", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "آخر إصدارات المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/featured",
        "almutawassit.png",
        filePath
    );
});

app.get("/books_by_category", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "الأصناف | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/books_by_category",
        "almutawassit.png",
        filePath
    );
});

app.get("/books_by_series", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "السلاسل | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/books_by_series",
        "almutawassit.png",
        filePath
    );
});

app.get("/furthercoming", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "يأتي قريبا | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/furthercoming",
        "almutawassit.png",
        filePath
    );
});

app.get("/ourWriters/writers", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "كتاب المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourWriters/writers",
        "almutawassit.png",
        filePath
    );
});

app.get("/author/:id", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    fs.readFile(filePath, "utf8", async (err, data) => {
        if (err) {
            console.log(err);
            return res.redirect('/');
        }

        try {
            const dataR = await axios.get(`https://admin.almutawassit.it/api/authors/${req.params.id}`, { headers });
            
            data = data
                .replace(/__TITLE__/g, dataR.data.name || "كاتب | منشورات المتوسط")
                .replace(/__DESCRIPTION__/g, dataR.data.author_bio || "كاتب من منشورات المتوسط")
                .replace(/__KEYWORDS__/g, dataR.data.name || "منشورات المتوسط")
                .replace(/__IMAGE__/g, replaceImageUrl(dataR.data.image))
                .replace(/__URL__/g, "https://almutawassit.it/author/" + dataR.data.id);

            res.send(data);
        } catch (error) {
            console.log('Error fetching author:', error);
            res.redirect('/');
        }
    });
});

app.get("/ourWriters/publishConditions", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "أنشر معنا | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourWriters/publishConditions",
        "almutawassit.png",
        filePath
    );
});

app.get("/videos", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "فيديو المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/videos",
        "almutawassit.png",
        filePath
    );
});

app.get("/podcast", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "بودكاست المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/podcast",
        "almutawassit.png",
        filePath
    );
});

app.get("/events", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "نشاطات المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/events",
        "almutawassit.png",
        filePath
    );
});

app.get("/blog", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "مدونة المتوسط | منشورات المتوسط",
        "دار نشر مستقلة ذات موقف جذري، وهي تؤسس ديناميكية في اختياراتها وآليات عملها انطلاقاً من موقفها. تنشط من مدينة ميلانو (معاً لنحارب طواحين الهواء).",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/blog",
        "almutawassit.png",
        filePath
    );
});

app.get("/ourProjects/divineComedy", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "الكوميديا الإلهية | منشورات المتوسط",
        "بدأت منشورات المتوسط العمل على إعادة إنتاج ترجمة حسن عثمان لكتاب \"الكوميديا الإلهية\" لـ دانتي أليغييري، حيث كلَّفت لجنة علمية من كبار الأكاديميين والمترجمين المتخصصين في ترجمة ونقل التراث بين اللغتين الإيطالية والعربية، ببدء العمل على المشروع.",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourProjects/divineComedy",
        "comedy-min.e3419654.jpg",
        filePath
    );
});

app.get("/ourProjects/translationForum", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "ملتقى الترجمة والأدب العالمي نحو مأسسة الفعل الثقافي | منشورات المتوسط",
        "أطلقت منشورات المتوسط فكرة تنظيم ملتقى للترجمة عام 2016، حيث عقدت سنته الأولى في مدينة ميلانو الإيطالية، وكان هدفها هو تسليط الضوء على الترجمة بوصفها نشاطاً ثقافياً ومؤسساً وفاعلاً في أي عملية تبادل ثقافي وبين ثقافي.",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourProjects/translationForum",
        "conf-min.064a6708.jpg",
        filePath
    );
});

app.get("/ourProjects/arabCultureFestivalInMilan", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "مهرجان الثقافة العربية في ميلانو | منشورات المتوسط",
        "مهرجان الثقافة العربية في ميلانو هو مهرجان سنوي تُنظمه الجامعة الكاثوليكية في ميلانو ربيع كلَّ عام، وتسعى من خلاله المتوسط الشريك الأساسي في التنظيم، إلى خلق فضاءٍ أدبي وفني مفتوح بين المبدعين العرب والأجانب وبين طلبة الجامعة والتجارب الإبداعية العربية في شتّى المجالات.",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourProjects/arabCultureFestivalInMilan",
        "almutawassit.png",
        filePath
    );
});

app.get("/ourProjects/literatureIsStronger", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    serveHTMLWithMeta(
        res,
        "الأدب أقوى | منشورات المتوسط",
        "الأدب أقوى هي مبادرة ثقافية تهدف إلى مدِّ جسرٍ معرفيٍّ بين الكاتب والكتاب في فلسطين وخارجها، مما يتيح المجال لتجاوز الكثير من العقبات والعراقيل التي يفرضها الاحتلال الصهيوني للحيلولة دون وصول الكتاب العربي إلى فلسطين، والتي يسعى من خلالها إلى تعميق الحصار والعزل الثقافي بين فلسطين وبعدها العربي والإنساني.",
        "منشورات المتوسط , إيطاليا , كتب , كتاب , دار نشر , بيع كتب , اقرأ , قراءة , مقتبسات , ثقافة , فلسفة , فكر , أدب , أدب مقارن , رواية , قصة , شعر , آداب , نقد , سيرة , نصوص , كتب للبيع , اقتناء كتب , ترجمة , أدب عالمي , أدب عربي , كتب قرأتها , مطالعة , مكتبة , ميلانو , كتب بالعربي , اللغة العربية , المتوسط , أدب إيطالي , الحياة الإيطالية , تعرف على إيطاليا , المطبخ الإيطالي , كرة القدم الإيطالية , أزياء إيطالية , وجبات إيطالية , عبد الفتاح كيليطو , عبد السلام بن عبد العالي , سعاد العامري , يارا الغضبان , ريكاردو بيجليا , دي لامبيدوزا , سامر أبو هواش , أمارجي , محمد الأشعري , خوان خوسيه مياس , بول أوستر , اختراع العزلة , جوزبه كاتوتسيلا , سلامة كيلة , فواز طرابلسي , أنطونيو غرامشي , إميليو سلغاري , كارل ماركس , لا تقولي إنك خائفة , المتن المجهول , أليساندرو باريكو , معرض الجثث , محمود درويش , حسن بلاسم , جون ريد , عشرة أيام هزت العالم , ثياب الإمبراطور , فوزي كريم , إدوارد سعيد , حميد دباشي , سيمفونية الموتى , نهر الزمن , القرصان الأسود , من الظل , بينوكيو , دون كيشوت ,Almutawassit Books  , almutawassit , Mediterraneo , casa editrice araba , editori arabi , mediterranean , mondo arabo , libri sul mondo arab",
        "https://almutawassit.it/ourProjects/literatureIsStronger",
        "almutawassit.png",
        filePath
    );
});

app.get("/book/:id", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    fs.readFile(filePath, "utf8", async (err, data) => {
        if (err) {
            console.log(err);
            return res.redirect('/');
        }

        try {
            const dataR = await axios.get(`https://admin.almutawassit.it/api/books/${req.params.id}`, { headers });
            const desc = new jsdom.JSDOM(dataR.data.description);
            
            const description = desc.window.document.querySelector("p") 
                ? desc.window.document.querySelector("p").textContent 
                : (desc.window.document.querySelector("div") 
                    ? desc.window.document.querySelector("div").textContent 
                    : "كتاب من منشورات المتوسط");

            const keywords = dataR.data.tags && dataR.data.tags.length > 0 
                ? dataR.data.tags.map(word => word.name.en).join(', ')
                : "منشورات المتوسط";

            data = data
                .replace(/__TITLE__/g, dataR.data.title || "كتاب | منشورات المتوسط")
                .replace(/__DESCRIPTION__/g, description)
                .replace(/__KEYWORDS__/g, keywords)
                .replace(/__IMAGE__/g, replaceImageUrl(dataR.data.cover))
                .replace(/__URL__/g, "https://almutawassit.it/book/" + dataR.data.id);

            res.send(data);
        } catch (error) {
            console.log('Error fetching book:', error);
            res.redirect('/');
        }
    });
});

app.get("/singlePost/:id", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    fs.readFile(filePath, "utf8", async (err, data) => {
        if (err) {
            console.log(err);
            return res.redirect('/');
        }

        try {
            const dataR = await axios.get(`https://admin.almutawassit.it/api/articles/${req.params.id}`, { headers });
            const desc = new jsdom.JSDOM(dataR.data.body);

            const description = desc.window.document.querySelector("p") 
                ? desc.window.document.querySelector("p").textContent 
                : (desc.window.document.querySelector("div") 
                    ? desc.window.document.querySelector("div").textContent 
                    : "مقال من منشورات المتوسط");

            const keywords = dataR.data.tags && dataR.data.tags.length > 0 
                ? dataR.data.tags.map(word => word.name.en).join(', ')
                : "منشورات المتوسط";

            data = data
                .replace(/__TITLE__/g, dataR.data.title || "مقال | منشورات المتوسط")
                .replace(/__DESCRIPTION__/g, description)
                .replace(/__KEYWORDS__/g, keywords)
                .replace(/__IMAGE__/g, replaceImageUrl(dataR.data.image))
                .replace(/__URL__/g, "https://almutawassit.it/singlePost/" + dataR.data.id);

            res.send(data);
        } catch (error) {
            console.log('Error fetching article:', error);
            res.redirect('/');
        }
    });
});

app.get("/singlePodcast/:id", (req, res) => {
    const filePath = path.resolve(__dirname, "./build", "index.html");
    fs.readFile(filePath, "utf8", async (err, data) => {
        if (err) {
            console.log(err);
            return res.redirect('/');
        }

        try {
            const dataR = await axios.get(`https://admin.almutawassit.it/api/podcast/${req.params.id}`, { headers });
            const desc = new jsdom.JSDOM(dataR.data.podcast.description);
            
            const description = desc.window.document.querySelector("p") 
                ? desc.window.document.querySelector("p").textContent 
                : (desc.window.document.querySelector("div") 
                    ? desc.window.document.querySelector("div").textContent 
                    : "بودكاست من منشورات المتوسط");

            data = data
                .replace(/__TITLE__/g, dataR.data.podcast.title || "بودكاست | منشورات المتوسط")
                .replace(/__DESCRIPTION__/g, description)
                .replace(/__KEYWORDS__/g, dataR.data.podcast.title || "منشورات المتوسط")
                .replace(/__IMAGE__/g, replaceImageUrl(dataR.data.podcast.image))
                .replace(/__URL__/g, "https://almutawassit.it/singlePodcast/" + dataR.data.podcast.id);

            res.send(data);
        } catch (error) {
            console.log('Error fetching podcast:', error);
            res.redirect('/');
        }
    });
});

// Serve static files
app.use(express.static(path.resolve(__dirname, "./build")));

// 404 handler - redirect to home for any unmatched routes
app.get('*', (req, res) => {
    res.redirect('/');
});

app.listen(PORT, () => {
    console.log(`Server is listening on port ${PORT}`);
});
